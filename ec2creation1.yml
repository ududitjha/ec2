---
 - hosts: localhost
   tasks:

   - name: Setting up Security/Firewall Group
     ec2_group:
       name: default
       description: Rules Allowing Traffic on port 22 and 80
       region: us-east-2
       rules:
        - proto: tcp
          from_port: 80
          to_port: 80
          cidr_ip: 0.0.0.0/0
        - proto:  tcp
          from_port: 22
          to_port:  22
          cidr_ip: 0.0.0.0/0
       rules_egress:
        - proto: all
          cidr_ip: 0.0.0.0/0
   - name: Provision a EC2 Instance
     ec2:
       key_name: '{{ key_name }}'
       region: '{{ region }}'
       instance_type: '{{ instance_type }}'
       image: '{{ image }}'
       wait: yes
       wait_timeout: 500
       count: '{{ count }}'
       instance_tags:
         Name: '{{ NAME }}'
         Owner: '{{ Owner }}'
       volumes:
       - device_name: '{{ device_name }}'
         volume_type: '{{ volume_type }}'
         volume_size: '{{ volume_size }}'
       monitoring: no
       vpc_subnet_id: subnet-c063988c
       assign_public_ip: yes
       group: default
     register: ec2_out

   - name: Wait for SSH to come up
     wait_for: host={{ item.public_dns_name }} port=22 delay=120 timeout=560 state=started
     with_items: '{{ec2_out.instances}}'
